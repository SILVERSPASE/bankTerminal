<!DOCTYPE html>
<html lang='ru'>
<meta charset="utf-8">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<link rel="stylesheet" type="text/css" href="css/styles.css">

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-route.js"></script>
<script src="js/app.js"></script>
<script src="js/modules/mainController.js"></script>
<script src="js/modules/userController.js"></script>
<script src="js/modules/routeController.js"></script>
<script src="js/modules/popUpMsg.js"></script>
<script src="js/modules/filters.js"></script>
<script src="js/modules/directives.js"></script>
<script src="js/modules/dataStorage.js"></script>
<script src="js/modules/dirPagination.js"></script>
<!-- <script src="js/modules/paginationController.js"></script> -->

<body data-ng-app = 'app'>
	<div data-ng-controller = 'mainCtrl'>
		<div class="container">
			<div class="row">
				<div class="col-md-6">
  					<a href="#/">Home</a> <span>{{userValue.name}}</span>
  					<a href="#/debtor">Список должников</a>
  				</div>
  				<div class="col-md-6">
					<div class="currencyCourse">
						<span ng-repeat = '(currencyKey, currencyValue) in currencyList'>
  							{{currencyKey}} : {{currencyValue}}
  						</span>
					</div>
  				</div>
  			</div>
  			<div class="row">
				<ng-view></ng-view>	<!-- ng-route directive  -->
				<pop-up-msg></pop-up-msg> <!--  info message -->
			</div>
		</div>
	</div>

<!-- home page  ########################################################-->
<script type="text/ng-template" id="mainPage.html">

    <div class="createNewCard">
		<form ng-submit = 'addNewUser(pasport, name)' class = 'newUserForm'>
			<div class="col-md-4">
				<input type="text" data-ng-model = 'name'  placeholder="Имя" required >
			</div>
			<div class="col-md-4">
				<input type="text" data-ng-model = 'pasport'  placeholder="Паспорт" required >
			</div>
			<div class="col-md-4">
				<button>Создать нового пользователя</button>
			</div>
		</form>
	</div>
	<div class="userList">
		<h2>Список карточек</h2>
			<div class="col-md-4">
				<label for="search">Поиск:</label>
           		<input ng-model="q" id="search" class="form-control" placeholder="Filter text">
			</div>
			<div class="col-md-4">
            	<label for="search">Позиций на странице:</label>
            	<input type="number" min="1" max="100" class="form-control" ng-model="pageSize">
			</div>
			<div class="col-md-4">
				<dir-pagination-controls 	boundary-links="true" 
											on-page-change="pageChangeHandler(newPageNumber)" 
											template-url="dirPagination.tpl.html">
				</dir-pagination-controls>
			</div>
         
		<table>
			<tr>
				<th>#</th>
				<th>Паспорт</th>
				<th data-ng-click = 'setOrder = "name"; reverse = !reverse'>Владелец</th>
				<th>Номер</th>	
				<th>Баланс</th>
				<th>Валюта</th>
				<th>Статус</th>
				<th></th>
			</tr>
			<!-- <div dir-paginate="meal in meals | filter:q | itemsPerPage: pageSize" current-page="currentPage"></div> -->
			<tr dir-paginate = 'userKey in userListArr | filter:q | itemsPerPage: pageSize' current-page="currentPage"  >
			<!-- <tr data-ng-repeat = 'userKey in userListArr' > -->

				<td>{{$index+1}}</td>
				<td>{{userKey}}</td>
				<td>{{userList[userKey].name}}</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userList[userKey].cardInfo'>
						{{cardInfoValue.number}}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userList[userKey].cardInfo'>
						{{cardInfoValue.balance | number : 2}}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userList[userKey].cardInfo'>
						{{cardInfoValue.currency}}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userList[userKey].cardInfo'>
						{{cardInfoValue.status}}
					</span>
				</td>
				<td>
					<a href="#/userPage"  data-ng-click = 'createActiveUser(userKey)'>Кабинет пользователя</a>
				</td>
			</tr>
		</table>
	</div>
	<a href="#/ocean" class = 'button' ng-click = 'stoleAllMoney()' style = 'margin: 35px auto; display: block; width: 500px; text-align: center;'>Обналичить все и улететь на Мальдивы</a>

</script>

<script type="text/ng-template" id="debtor.html">
	<div class="userList">
		<h2>Список карточек</h2>
		<input type="text" data-ng-model = 'userSeach' placeholder="Имя или паспорт">
		<table>
			<tr>
				<th>#</th>
				<th>Паспорт</th>
				<th>Владелец</th>
				<th>Номер</th>	
				<th>Баланс</th>
				<th>Валюта</th>
				<th>Статус</th>
				<th></th>
			</tr>
			<tr data-ng-repeat = '(userKey, userValue) in debtorList | customFilter : userSeach' >
				<td>{{$index+1}}</td>
				<td>{{userKey}}</td>
				<td>{{userValue.name}}</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.number}}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.balance | number : 2}}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.currency}}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.status}}
					</span>
				</td>
				<td>
					<a href="#/userPage"  data-ng-click = 'createActiveUser(userKey)'>Кабинет пользователя</a>
				</td>
			</tr>
		</table>
	</div>
</script>

<!-- user page  ########################################################-->
<script type="text/ng-template" id="userPage.html">

<div data-ng-controller = 'userCtrl'>
<div data-ng-repeat = '(userKey, userValue) in activeUser'>
	<div class="col-md-5">
		<h2>Личный кабинет</h2>
		<table>
			<tr>
				<td>Имя: </td>
				<td>{{userValue.name}}</td>
			</tr>
			<tr>
				<td>Паспорт:</td> 
				<td>{{userKey}}</td>
			</tr>
		</table>

		<h2>История платежей</h2>

		<div data-ng-hide = hasHistory(userKey) >История платежей пуста</div>
		<div data-ng-show = hasHistory(userKey) >

			<table> 
				<tr>
					<th>Дата</th>
					<th>Сумма</th>
					<th>От</th>
					<th>До</th>
				</tr>
				<tr data-ng-repeat = '(historyKey, historyValue) in userValue.history'>
					<td>{{historyValue.date | date:'dd.MM.yy HH:mm'}}</td>
					<td>{{historyValue.sum | number : 2 }} {{historyValue.currency}}</td>
					<td>{{historyValue.from}}</td>
					<td>{{historyValue.to}}</td>
				</tr>
			</table>
		</div>
	</div>
	<div class="col-md-7">
		<h2>Список карточек</h2>
		<div data-ng-hide = hasCards(userKey)>Карточек еще нет</div>
		<table data-ng-show = hasCards(userKey)>
			<tr>
				<th>Номер</th>
				<th>Баланс</th>
				<th>Валюта</th>
				<th>Пин код</th>
				<th>Статус</th>
				<th></th>
				<th></th>
			</tr>
			<tr data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
				<td>{{cardInfoValue.number}}</td>
				<td>{{cardInfoValue.balance | number : 2}}</td>
				<td>{{cardInfoValue.currency}}</td>
				<td>{{cardInfoValue.pinCode}}</td>
				<td>{{cardInfoValue.status}}</td>
				<td>
					<div class = 'promtWrapper'>
						<button data-ng-click = 'showPromtBlock = true'>
							<span data-ng-show = this.cardInfoValue.status>Блокировать</span>
							<span data-ng-hide = this.cardInfoValue.status>Разблокировать</span></button>
						<div ng-show = 'showPromtBlock' class = 'showPromt showPromtBlock'>
							<span data-ng-show = this.cardInfoValue.status>Блокировать?</span>
							<span data-ng-hide = this.cardInfoValue.status>Разблокировать?</span>
							<button data-ng-click = 'this.cardInfoValue.status = !this.cardInfoValue.status; showPromtBlock = false'>Да</button>
							<button data-ng-click = 'showPromtBlock = false'>Отмена</button>
						</div>
					</div>
				</td>
				<td>
					<div class = 'promtWrapper'>
						<button data-ng-click = 'showPromtDelete = true'>Удалить</button>
						<div ng-show = 'showPromtDelete' class = 'showPromt'>
							Удалить?
							<button data-ng-click = 'deleteCard(userKey, cardInfoKey)'>Да</button>
							<button data-ng-click = 'showPromtDelete = false'>Отмена</button>
						</div>
					</div>
				</td>
			</tr>
		</table>

		<div class="billPanel">
			<div class="col-md-6">
				<label>
					<input type="radio" ng-model="billPoint" name="createNewCard" ng-value = 'createNewCard' />
					<span>Нова карточка</span>
				</label>
				<label>
					<input type="radio" ng-model="billPoint" value="makePay" name="makePay" />
					<span>Провести платеж</span>
				</label>
				<label>
					<input type="radio" ng-model="billPoint" value="changeCurrency" name="changeCurrency" />
					<span>В другую валюту</span>
				</label>
				<label>
					<input type="radio" ng-model="billPoint" value="addFunds" name="addFunds" />
					<span>Пополнить баланс</span>
				</label>
			</div>
			<div class="col-md-6">
				<div ng-switch on="billPoint">
					<div ng-switch-default="createNewCard">
					<!-- add new card! -->
						<div class="createNewCard">
							<form data-ng-submit = 'addNewCard(pinCode, currency, balance, userKey)'>
								<input type="text" data-ng-model = 'pinCode' placeholder = 'Пин код' required>
								<select name="currencySelect" id="currencySelect" ng-model="currency" required>
									<option value="" selected disabled>Валюта</option>
									<option value="uah">uah</option>
						      		<option value="euro">euro</option>
						      		<option value="usd">usd</option>
								</select>
								<input type="number" data-ng-model = 'balance' min="0" placeholder = 'Баланс' required>
								<button>Добавить карточку</button>
							</form>
						</div>
					</div>

					<div ng-switch-when="makePay">
					<!-- make money transform -->
						<div class="makePay">
							<form data-ng-submit = 'makePay(userKey,cardInfoKey, sum, cardListKey)'>
								<select name="makePay" id="makePay" data-ng-model = 'cardInfoKey' required>
									<option value="" selected disabled>Ваша карта</option>
									<option ng-repeat='(cardInfoKey, cardInfoValue) in userValue.cardInfo' value="{{cardInfoKey}}">
										{{cardInfoValue.number}}
									</option>
								</select>
								<input type="number" data-ng-model = 'sum' min="0" placeholder = 'сумма' required>
								<select name="makePay" id="makePay" data-ng-model = 'cardListKey' required>
									<option value="" disabled selected>Карта получателя</option>
									<option data-ng-repeat = '(cardListKey, cardListValue) in cardList' value="{{cardListKey}}">
										{{cardListValue.number}} : 
										{{cardListValue.currency}} : 
										{{userList[cardListValue.userKey].name}}
									</option>
								</select>
								<button>Перевести средства</button>
							</form>
						</div>
					</div>
					<div ng-switch-when="changeCurrency">
						<form data-ng-submit = 'changeCurrency(userKey,cardInfoKey, sum, cardListKey)'>
							<select name="changeCurrency" id="changeCurrency" data-ng-model = 'cardInfoKey' required>
								<option value="" disabled selected>Ваша карта</option>
								<option ng-repeat='(cardInfoKey, cardInfoValue) in userValue.cardInfo' value="{{cardInfoKey}}">
									{{cardInfoValue.number}}
								</option>
							</select>
							<input type="number" data-ng-model = 'sum' min="0" placeholder = 'сумма' required>
							<select name="changeCurrency" id="changeCurrency" data-ng-model = 'cardListKey' required>
								<option value="" disabled selected>Карта получателя</option>
								<option data-ng-repeat = '(cardListKey, cardListValue) in cardList' value="{{cardListKey}}">
									{{cardListValue.number}} :
									{{cardListValue.currency}} : 
									{{userList[cardListValue.userKey].name}}
								</option>
							</select>
							<button>Перевести средства</button>
						</form>
					</div>

					<div ng-switch-when="addFunds">
					<!-- add funds -->
						<div class="addFunds">
							<form data-ng-submit = 'addFunds(userKey,cardInfoKey, addSum)'>
								<select name="addFunds" id="addFunds" data-ng-model = 'cardInfoKey' required>
									<option value="" disabled selected>Выберите карту</option>
									<option ng-repeat='(cardInfoKey, cardInfoValue) in userValue.cardInfo' value="{{cardInfoKey}}">
										{{cardInfoValue.number}}
									</option>
								</select>
								<input type="number" data-ng-model = 'addSum' min="0" placeholder = 'сумма' required>
								<button>Пополнить</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</div>

</script>

<script type="text/ng-template" id="ocean.html">
<iframe width="100%" height="800" src="https://www.youtube.com/embed/HTc_2XmKK-M?rel=0&autoplay=1" frameborder="0" allowfullscreen></iframe>
</script>



</body>
</html>

