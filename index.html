<!DOCTYPE html>
<html>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<link rel="stylesheet" type="text/css" href="css/iDiaologStyle.css">
<link rel="stylesheet" type="text/css" href="css/styles.css">

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-route.js"></script>
<script src="js/app.js"></script>
<script src="js/modules/mainController.js"></script>
<!-- <script src="js/modules/userController.js"></script> -->
<script src="js/modules/routeController.js"></script>
<script src="js/modules/idialog.js"></script>


<body data-ng-app = 'app'>
	<div data-ng-controller = 'mainCtrl'>
		<div class="container">
			<div class="row"> 
  				<div class="col-md-6">
  					<a href="#/">Home</a> <span>{{userValue.name}}</span>
  				</div>
  				<div class="col-md-6">
					<div class="currencyCourse">
						<span ng-repeat = '(currencyKey, currencyValue) in currencyList'>
  							{{currencyKey}} : {{currencyValue}}
  						</span>
					</div>
  				</div>
  			</div>
  			<div class="row">
				<ng-view></ng-view>	<!-- ng-route directive -->
				<pop-up-msg></pop-up-msg>  <!-- info message -->
			</div>
		</div>
	</div>

<!-- home page  ########################################################-->
<script type="text/ng-template" id="mainPage.html">

    <div class="createNewCard">
		<form ng-submit = 'addNewUser(pasport, name)'>
			<input type="text" data-ng-model = 'name'  placeholder="Имя" required >
			<input type="text" data-ng-model = 'pasport'  placeholder="Паспорт" required >
			<button>Создать нового пользователя</button>
		</form>
	</div>
	<div class="userList">
		<h2>Список карточек</h2>
		<input type="text" data-ng-model = 'userSeach' placeholder="Имя или паспорт">
		<table>
			<tr>
				<th>#</th>
				<th>Паспорт</th>
				<th data-ng-click = 'setOrder = "name"; reverse = !reverse'>Владелец</th>
				<th>Номер</th>	
				<th>Баланс</th>
				<th>Валюта</th>
				<th>Статус</th>
				<th></th>
			</tr>
			<tr data-ng-repeat = '(userKey, userValue) in userList | customFilter : userSeach | orderBy : "name" : reverse' >
				<td>{{$index+1}}</td>
				<td>{{userKey}}</td>
				<td>{{userValue.name}}</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.number}}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.balance }}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.currency}}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.status}}
					</span>
				</td>
				<td>
					<a href="#/userPage"  data-ng-click = 'createActiveUser(userKey)'>Кабинет пользователя</a>
				</td>
				<td>
				</td>
			</tr>
			<tr class="clearfix"></tr>
		</table>
	</div>

</script>

<!-- user page  ########################################################-->
<script type="text/ng-template" id="userPage.html">

<!-- <div data-ng-controller = 'userCtrl'> -->
<div data-ng-repeat = '(userKey, userValue) in activeUser'>
	<div class="col-md-5">
		<h2>Личный кабинет</h2>
		<table>
			<tr>
				<td>Имя: </td>
				<td>{{userValue.name}}</td>
			</tr>
			<tr>
				<td>Паспорт:</td> 
				<td>{{userKey}}</td>
			</tr>
		</table>

		<h2>История платежей</h2>
		<!-- {{userValue.history}} -->
		<div>
			<table>
				<tr>
					<th>Дата</th>
					<th>Сумма</th>
					<th>От</th>
					<th>До</th>
				</tr>
				<tr data-ng-repeat = '(historyKey, historyValue) in userValue.history'>
					<td>{{historyValue.date | date:'dd.MM.yy HH:mm'}}</td>
					<td>{{historyValue.sum}} {{historyValue.currency}}</td>
					<td>{{historyValue.from}}</td>
					<td>{{historyValue.to}}</td>
				</tr>
			</table>
		</div>
	</div>
	<div class="col-md-7">
		<h2>Список карточек</h2>
		<table>
			<tr>
				<th>Номер</th>
				<th>Баланс</th>
				<th>Валюта</th>
				<th>Пин код</th>
				<th>Статус</th>
				<th></th>
			</tr>
			<tr data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
				<td>{{cardInfoValue.number}}</td>
				<td>{{cardInfoValue.balance}}</td>
				<td>{{cardInfoValue.currency}}</td>
				<td>{{cardInfoValue.pinCode}}</td>
				<td>{{cardInfoValue.status}}</td>
				<td>
					<button data-ng-click = 'this.cardInfoValue.status = !this.cardInfoValue.status'>Блокировать</button>
				</td>
				<td>
					<button data-ng-click = 'deleteCard(userKey, cardInfoKey)'>	Удалить</button>
				</td>
			</tr>
		</table>

		<div class="billPanel">
			<div class="col-md-6">
				<label>
					<input type="radio" ng-model="billPoint" name="createNewCard" ng-value = 'createNewCard' />
					<span>Нова карточка</span>
				</label>
				<label>
					<input type="radio" ng-model="billPoint" value="makePay" name="makePay" />
					<span>Провести платеж</span>
				</label>
				<label>
					<input type="radio" ng-model="billPoint" value="changeCurrency" name="changeCurrency" />
					<span>В другую валюту</span>
				</label>
				<label>
					<input type="radio" ng-model="billPoint" value="addFunds" name="addFunds" />
					<span>Пополнить баланс</span>
				</label>
			</div>
			<div class="col-md-6">
				<div ng-switch on="billPoint">
					<div ng-switch-default="createNewCard">
					<!-- add new card! -->
						<div class="createNewCard">
							<form data-ng-submit = 'addNewCard(pinCode, currency, balance, userKey)'>
								<input type="text" data-ng-model = 'pinCode' placeholder = 'Пин код' required>
								<select name="currencySelect" id="currencySelect" ng-model="currency" required>
									<option value="" selected disabled>Валюта</option>
									<option value="uah">uah</option>
						      		<option value="euro">euro</option>
						      		<option value="usd">usd</option>
								</select>
								<input type="number" data-ng-model = 'balance' min="0" placeholder = 'Баланс' required>
								<button>Добавить карточку</button>
							</form>
						</div>
					</div>

					<div ng-switch-when="makePay">
					<!-- make money transform -->
						<div class="makePay">
							<select name="makePay" id="makePay" data-ng-model = 'cardInfoKey' >
								<option value="" disabled selected>Ваша карта</option>
								<option ng-repeat='(cardInfoKey, cardInfoValue) in userValue.cardInfo' value="{{cardInfoKey}}">
									{{cardInfoValue.number}}
								</option>
							</select>
							<input type="number" data-ng-model = 'sum' min="0" placeholder = 'сумма' required>
							<select name="makePay" id="makePay" data-ng-model = 'receiver' required>
								<option value="" disabled selected>Карта получателя</option>
								<option data-ng-repeat = '(cardListKey, cardListValue) in cardList' value="{{cardListKey}}">
									{{cardListValue.number}} : {{userList[cardListValue.userKey].name}}
								</option>
							</select>
							<button data-ng-click = 'makePay(userKey,cardInfoKey, sum, receiver)'>Перевести средства</button>
						</div>
					</div>
					<div ng-switch-when="changeCurrency">
						<select name="changeCurrency" id="changeCurrency" data-ng-model = 'cardInfoKey2' >
							<option value="" disabled selected>Ваша карта</option>
							<option ng-repeat='(cardInfoKey, cardInfoValue) in userValue.cardInfo' value="{{cardInfoKey}}">
								{{cardInfoValue.number}}
							</option>
						</select>
						<input type="number" data-ng-model = 'sum2' min="0" placeholder = 'сумма' required>
						<select name="changeCurrency" id="changeCurrency" data-ng-model = 'receiver2' required>
							<option value="" disabled selected>Карта получателя</option>
							<option data-ng-repeat = '(cardListKey, cardListValue) in cardList' value="{{cardListKey}}">
								{{cardListValue.number}} : {{userList[cardListValue.userKey].name}}
							</option>
						</select>
						<button data-ng-click = 'changeCurrency(userKey,cardInfoKey2, sum2, receiver2)'>Перевести средства</button>
					</div>

					<div ng-switch-when="addFunds">
					<!-- add funds -->
						<div class="addFunds">
							<form data-ng-submit = 'addFunds(userKey,cardInfoKey1, addSum)'>
								<select name="addFunds" id="addFunds" data-ng-model = 'cardInfoKey1' required>
									<option value="" disabled selected>Выберите карту</option>
									<option ng-repeat='(cardInfoKey, cardInfoValue) in userValue.cardInfo' value="{{cardInfoKey}}">
										{{cardInfoValue.number}}
									</option>
								</select>
								<input type="number" data-ng-model = 'addSum' min="0" placeholder = 'сумма' required>
								<button>Пополнить</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- </div> -->

</script>



</body>
</html>

