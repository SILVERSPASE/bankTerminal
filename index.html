<!DOCTYPE html>
<html>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/styles.css">

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-route.js"></script>
<script src="js/app.js"></script>
<script src="js/modules/mainController.js"></script>
<!-- <script src="js/modules/userController.js"></script> -->
<script src="js/modules/routeController.js"></script>

<body data-ng-app = 'app'>
	<div data-ng-controller = 'mainCtrl'>
		<div class="container">
			<div class="row"> 
				<a href="#/">Home</a> <span>{{userValue.name}}</span>
				<ng-view></ng-view>	
			</div>
		</div>
	</div>

<!-- home page  ########################################################-->
<script type="text/ng-template" id="mainPage.html">

    <div class="createNewCard">
		<input type="text" data-ng-model = 'name'  placeholder="Имя" >
		<input type="text" data-ng-model = 'pasport'  placeholder="Паспорт">
		<button data-ng-click = 'addNewUser(pasport, name)'>Создать нового пользователя</button>
	</div>
	<div class="userList">
		<h2>Список карточек</h2>
		<input type="text" data-ng-model = 'userSeach' placeholder="Имя или паспорт">
		<table>
			<tr>
				<th>#</th>
				<th>Паспорт</th>
				<th data-ng-click = 'setOrder = "name"; reverse = !reverse'>Владелец</th>
				<th>Номер</th>	
				<th>Баланс</th>
				<th>Валюта</th>
				<th>Статус</th>
			</tr>
			<tr data-ng-repeat = '(userKey, userValue) in userList | customFilter : userSeach | orderBy : "name" : reverse' >
				<td>{{$index+1}}</td>
				<td>{{userKey}}</td>
				<td>{{userValue.name}}</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.number}}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.balance }}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.currency}}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.status}}
					</span>
				</td>
				<td>
					<a href="#/userPage"  data-ng-click = 'createActiveUser(userKey)'>Кабинет пользователя</a>
				</td>
			</tr>
			<tr class="clearfix"></tr>
		</table>
	</div>

</script>

<!-- user page  ########################################################-->
<script type="text/ng-template" id="userPage.html">

<!-- <div data-ng-controller = 'userCtrl'> -->
<div data-ng-repeat = '(userKey, userValue) in activeUser'>
	<div class="col-md-4">
		<h2>Личный кабинет</h2>
		<table>
			<tr>
				<td>Имя: </td>
				<td>{{userValue.name}}</td>
			</tr>
			<tr>
				<td>Паспорт:</td> 
				<td>{{userKey}}</td>
			</tr>
		</table>
	</div>
	<div class="col-md-8">
		<h2>Список карточек</h2>
		<table>
			<tr>
				<th>Номер</th>
				<th>Баланс</th>
				<th>Валюта</th>
				<th>Пин код</th>
				<th>Статус</th>
			</tr>
			<tr data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
				<td>{{cardInfoValue.number}}</td>
				<td>{{cardInfoValue.balance}}</td>
				<td>{{cardInfoValue.currency}}</td>
				<td>{{cardInfoValue.pinCode}}</td>
				<td>{{cardInfoValue.status}}</td>
				<td><button data-ng-click = 'this.cardInfoValue.status = !this.cardInfoValue.status'>Блокировать</button></td>
			</tr>
		</table>
	</div>

<!-- add new card! -->
	<div class="billPanel">
		<div class="col-md-4">
			<input type="text" data-ng-model = 'pinCode' placeholder = 'Пин код'>
			<select name="currencySelect" id="currencySelect" ng-model="currency">
				<option value="" disabled selected>Валюта</option>
				<option value="uah">uah</option>
	      		<option value="euro">euro</option>
	      		<option value="usd">usd</option>
			</select>

			<input type="text" data-ng-model = 'balance' placeholder = 'Баланс'>
			<button data-ng-click = 'addNewCard(pinCode, currency, balance, userKey)'>Добавить карточку</button>
		</div>

<!-- make pay -->
		<div class="col-md-4">
			<select name="makePay" id="makePay" data-ng-model = 'cardInfoKey' >
				<option value="" disabled selected>Выберите карту</option>
				<option ng-repeat='(cardInfoKey, cardInfoValue) in userValue.cardInfo' value="{{cardInfoKey}}">
					{{cardInfoValue.number}}
				</option>
			</select>
			<input type="text" data-ng-model = 'sum' placeholder = 'sum'>
			<input type="text" data-ng-model = 'destination' placeholder = 'destination'>
			<button data-ng-click = 'makePay(userKey,cardInfoKey, sum, destination)'>Провести платеж</button>
		</div>

<!-- add funds -->
		<div class="col-md-4">
			<select name="makePay" id="makePay" data-ng-model = 'cardInfoKey' >
				<option value="" disabled selected>Выберите карту</option>
				<option ng-repeat='(cardInfoKey, cardInfoValue) in userValue.cardInfo' value="{{cardInfoKey}}">
					{{cardInfoValue.number}}
				</option>
			</select>
			<input type="text" data-ng-model = 'addSum' placeholder = 'sum'>
			<button data-ng-click = 'addFunds(userKey,cardInfoKey, addSum)'>Провести платеж</button>
		</div>
	</div>
</div>
<!-- </div> -->

</script>


</body>
</html>

