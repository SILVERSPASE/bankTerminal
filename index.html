<!DOCTYPE html>
<html>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/styles.css">

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-route.js"></script>
<script src="js/app.js"></script>
<script src="js/modules/mainController.js"></script>
<!-- <script src="js/modules/userController.js"></script> -->
<script src="js/modules/routeController.js"></script>

<body data-ng-app = 'app'>
	<div data-ng-controller = 'mainCtrl'>
		<div class="container">
			<div class="row"> 
				<a href="#/">Home</a> <span>{{userValue.name}}</span>
				<ng-view></ng-view>	

<!-- 				<div data-ng-repeat = '(cardListKey, cardListValue) in cardList'>
					{{cardListValue.number}}
				</div>
 -->

<!-- <div data-ng-repeat = '(userKey, userValue) in userList'>
	<div data-ng-repeat = '(cardKey, cardValue) in userValue.cardInfo'>
		{{cardValue.number}}
	</div>
</div> -->
			</div>
		</div>
	</div>

<!-- home page  ########################################################-->
<script type="text/ng-template" id="mainPage.html">

    <div class="createNewCard">
		<input type="text" data-ng-model = 'name'  placeholder="Имя" >
		<input type="text" data-ng-model = 'pasport'  placeholder="Паспорт">
		<button data-ng-click = 'addNewUser(pasport, name)'>Создать нового пользователя</button>
	</div>
	<div class="userList">
		<h2>Список карточек</h2>
		<input type="text" data-ng-model = 'userSeach' placeholder="Имя или паспорт">
		<table>
			<tr>
				<th>#</th>
				<th>Паспорт</th>
				<th data-ng-click = 'setOrder = "name"; reverse = !reverse'>Владелец</th>
				<th>Номер</th>	
				<th>Баланс</th>
				<th>Валюта</th>
				<th>Статус</th>
				<th></th>
			</tr>
			<tr data-ng-repeat = '(userKey, userValue) in userList | customFilter : userSeach | orderBy : "name" : reverse' >
				<td>{{$index+1}}</td>
				<td>{{userKey}}</td>
				<td>{{userValue.name}}</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.number}}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.balance }}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.currency}}
					</span>
				</td>
				<td>
					<span data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
						{{cardInfoValue.status}}
					</span>
				</td>
				<td>
					<a href="#/userPage"  data-ng-click = 'createActiveUser(userKey)'>Кабинет пользователя</a>
				</td>
			</tr>
			<tr class="clearfix"></tr>
		</table>
	</div>

</script>

<!-- user page  ########################################################-->
<script type="text/ng-template" id="userPage.html">

<!-- <div data-ng-controller = 'userCtrl'> -->
<div data-ng-repeat = '(userKey, userValue) in activeUser'>
	<div class="col-md-5">
		<h2>Личный кабинет</h2>
		<table>
			<tr>
				<td>Имя: </td>
				<td>{{userValue.name}}</td>
			</tr>
			<tr>
				<td>Паспорт:</td> 
				<td>{{userKey}}</td>
			</tr>
		</table>

		<h2>История платежей</h2>
		<table>
			<tr>
				<th>date</th>
				<th>sum</th>
				<th>from</th>
				<th>to</th>
			</tr>
			<tr data-ng-repeat = '(historyKey, historyValue) in userValue.history'>
				<td>{{historyValue.date | date:'MM/dd/yy h:mma'}}</td>
				<td>{{historyValue.sum}} {{historyValue.currency}}</td>
				<td>{{historyValue.from}}</td>
				<td>{{historyValue.to}}</td>
			</tr>
		</table>
	</div>
	<div class="col-md-7">
		<h2>Список карточек</h2>
		<table>
			<tr>
				<th>Номер</th>
				<th>Баланс</th>
				<th>Валюта</th>
				<th>Пин код</th>
				<th>Статус</th>
				<th></th>
			</tr>
			<tr data-ng-repeat = '(cardInfoKey, cardInfoValue) in userValue.cardInfo'>
				<td>{{cardInfoValue.number}}</td>
				<td>{{cardInfoValue.balance}}</td>
				<td>{{cardInfoValue.currency}}</td>
				<td>{{cardInfoValue.pinCode}}</td>
				<td>{{cardInfoValue.status}}</td>
				<td><button data-ng-click = 'this.cardInfoValue.status = !this.cardInfoValue.status'>Блокировать</button></td>
			</tr>
		</table>

		<div class="billPanel">
			<div class="col-md-5">
				<label>
					<input type="radio" ng-model="billPoint" checked="" value="createNewCard" name="createNewCard" />
					<span>createNewCard</span>
				</label>
				<label>
					<input type="radio" ng-model="billPoint" value="makePay" name="makePay" />
					<span>makePay</span>
				</label>
				<label>
					<input type="radio" ng-model="billPoint" value="addFunds" name="addFunds" />
					<span>addFunds</span>
				</label>
			</div>
			<div class="col-md-7">
				<div ng-switch on="billPoint">
					<div ng-switch-when="createNewCard">
					<!-- add new card! -->
						<div class="createNewCard">
							<input type="text" data-ng-model = 'pinCode' placeholder = 'Пин код'>
							<select name="currencySelect" id="currencySelect" ng-model="currency">
								<option value="" disabled selected>Валюта</option>
								<option value="uah">uah</option>
					      		<option value="euro">euro</option>
					      		<option value="usd">usd</option>
							</select>

							<input type="text" data-ng-model = 'balance' placeholder = 'Баланс'>
							<button data-ng-click = 'addNewCard(pinCode, currency, balance, userKey)'>Добавить карточку</button>
						</div>
					</div>

					<div ng-switch-when="makePay">
					<!-- make money transform -->
						<div class="makePay">
							<select name="makePay" id="makePay" data-ng-model = 'cardInfoKey' >
								<option value="" disabled selected>Ваша карта</option>
								<option ng-repeat='(cardInfoKey, cardInfoValue) in userValue.cardInfo' value="{{cardInfoKey}}">
									{{cardInfoValue.number}}
								</option>
							</select>
							<input type="text" data-ng-model = 'sum' placeholder = 'sum'>
							<select name="makePay" id="makePay" data-ng-model = 'receiver'>
								<option value="" disabled selected>Карта получателя</option>
								<option data-ng-repeat = '(cardListKey, cardListValue) in cardList'' value="{{cardListValue.number}}">
									{{cardListValue.number}} : {{userList[cardListValue.userKey].name}}
								</option>
							</select>

							<button data-ng-click = 'makePay(userKey,cardInfoKey, sum, receiver)'>Перевести средства</button>
						</div>
					</div>

					<div ng-switch-when="addFunds">
					<!-- add funds -->
						<div class="addFunds">
							<select name="addFunds" id="addFunds" data-ng-model = 'cardInfoKey1' >
								<option value="" disabled selected>Выберите карту</option>
								<option ng-repeat='(cardInfoKey, cardInfoValue) in userValue.cardInfo' value="{{cardInfoKey}}">
									{{cardInfoValue.number}}
								</option>
							</select>
							<input type="text" data-ng-model = 'addSum' placeholder = 'sum'>
							<button data-ng-click = 'addFunds(userKey,cardInfoKey1, addSum)'>Пополнить</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- </div> -->

</script>



</body>
</html>

